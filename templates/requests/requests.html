<table class="column width-20">
    <tr class="column-header">
        <td class="caption width-100">
            Заявки
            <button class="button green right"
                    ng-if="session.permissions.get('add_request').enabled.value === true"
                    ng-click="addRequest()">
                +
            </button>
        </td>

    </tr>
    <tr class="column-content-container">
        <td>
            <div class="column-content y-scrollable padding-5">
                <!--
                <ul class="list hover">
                    <div class="service-message" ng-show="titles.requests._states_.loaded() === false">
                        <img class="loading" src="resources/img/loader.gif" alt="Загрузка"/>
                        <span>Загрузка...</span>
                    </div>
                    <li ng-repeat="request in titles.requests.items track by $id(request)"
                        ng-class="{'active': request._states_.selected() === true}"
                        ng-click="selectTitle(title.id.value)">
                        <span class="primary-text">{{ title.title.value }}</span><br>
                        <span class="secondary-text" ng-class="{'light': title._states_.selected() === true }">
                            {{ titles.statuses.find("id", title.statusId.value).title.value }}
                        </span>
                    </li>
                </ul>
                -->

                <div class="service-message" ng-show="titles.requests._states_.loaded() == false">
                    <img class="loading" src="resources/img/loader.gif" alt="Загрузка"/>
                    <span>Загрузка...</span>
                </div>

                <div class="service-message" ng-show="titles.requests._states_.loaded() === true && titles.requests.size() === 0">
                    Заявки отсутствуют
                </div>

                <ul class="cards">
                    <li class="card"
                        ng-class="{'active': request._states_.selected() === true}"
                        ng-repeat="request in titles.requests.items | orderBy:'id.value' track by $index"
                        ng-click="selectRequest(request.id.value)">
                        <img src="../resources/img/icons/request.png" alt="" class="card-img icon"/>
                        <div class="card-header">
                            <span>{{ "Заявка #" + request.id.value }}</span>
                            <div class="right" ng-show="app.currentRequest.id.value === request.id.value">
                                <button class="button round blue"
                                        title="Редактировать"
                                        ng-if="session.permissions.get('edit_request').enabled.value === true"
                                        ng-click="editRequest(request.id.value, $event)">
                                    <img src="resources/img/icons/edit.png" alt=""/>
                                </button>
                                <button class="button round red"
                                        title="Удалить"
                                        ng-if="session.permissions.get('delete_request').enabled.value === true"
                                        ng-click="deleteRequest(request.id.value, $event)">&times;</button>
                            </div>
                        </div>
                        <div class="card-content">
                            <span class="secondary-text">
                                {{ contractors.contractors.find("id", request._backup_.data.investorId).title.value }}
                            </span>
                        </div>
                    </li>
                </ul>
            </div>
        </td>
    </tr>
</table>

<table class="column width-40">
    <tr class="column-header">
        <td class="caption width-100">
            Подробности
        </td>
    </tr>
    <tr class="column-content-container">
        <td>
            <div class="column-content no-padding">
                <div class="service-message" ng-show="app.currentRequest === undefined">
                    Выберите заявку
                </div>
                <div class="width-100 height-100">
                    <tabs tabs-source="tabs" tabs-position="top" ng-show="app.currentRequest !== undefined"></tabs>
                </div>
            </div>
        </td>
    </tr>
</table>


<table class="column width-40">
    <tr class="column-header">
        <td class="caption width-100">
            История
            <button class="button green right"
                    ng-show="app.currentRequest !== undefined"
                    ng-if="session.permissions.get('change_request_status').enabled.value === true"
                    ng-click="changeStatus()">
                +
            </button>
        </td>

    </tr>
    <tr class="column-content-container">
        <td>
            <div class="column-content y-scrollable padding-5">


                <div class="service-message" ng-show="app.currentRequestHistory._states_.loaded() === false">
                    <img class="loading" src="resources/img/loader.gif" alt="Загрузка"/>
                    <span>Загрузка...</span>
                </div>
                <div class="service-message" ng-show="app.currentRequest === undefined">
                    Выберите заявку
                </div>

                <ul class="cards">
                    <li class="card"
                        ng-repeat="history in app.currentRequestHistory.items | orderBy:'timestamp.value' track by $index">
                        <div class="row padding-5">
                            <span class="request-status-big left">{{ titles.requestStatuses.find("id", history.statusId.value).title.value }}</span>
                            <span class="right secondary-text">{{ history.timestamp.value | timestamp:"DDMMMYYYYHHmm" }}</span>
                            <hr/>
                        </div>
                        <div class="row padding-5" ng-show="history.description.value !== ''">
                            <span class="paragraph italic">{{ history.description.value }}</span>
                        </div>
                        <div class="row padding-5">

                            <!--
                            <div class="row split-5" ng-repeat="doc in app.currentRequestStatusDocs.items | byRequestId:app.currentRequest.id.value:history.id.value track by $id(doc)">
                                <div class="row paragraph">
                                    <a href="{{ 'serverside/controllers/downloader.php?docType=rsd&rsdId=' + doc.id.value }}">{{ doc.title.value }}</a>&nbsp;<span class="secondary-text">{{ doc.size.value | fileSize }}</span>
                                </div>
                            </div>
                            -->

                            <table class="table width-100 stripped condensed" ng-show="histDocs.length > 0">
                                <caption>Приложения</caption>
                                <tbody>
                                <tr ng-repeat="doc in histDocs = (app.currentRequestStatusDocs.items | byRequestId:app.currentRequest.id.value:history.id.value) track by $id(doc)">
                                    <td>
                                        <a href="{{ 'serverside/controllers/downloader.php?docType=rsd&rsdId=' + doc.id.value }}">{{ doc.title.value }}</a>&nbsp;
                                        <span class="secondary-text right">{{ doc.size.value | fileSize }}</span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>

                        </div>
                        <div class="row padding-5">
                            <span class="secondary-text" ng-show="history.statusId.value === 1">{{ "Заявку добавил " + users.users.find("id", history.userId.value).fio }}</span>
                            <span class="secondary-text" ng-show="history.statusId.value !== 1">{{ "Статус изменил " + users.users.find("id", history.userId.value).fio }}</span>
                        </div>
                    </li>
                </ul>



                <ul class="request-status">
                    <li ng-repeat="history in app.currentRequestHistory.items | orderBy:'timestamp.value' track by $index">

                        <div class="request-status-content">
                            <div class="row status-header">
                                <span class="secondary-text">{{ history.timestamp.value | timestamp:"DDMMMYYYYHHmm" }}</span>
                            </div>
                        </div>

                        <!--

                        <div class="row split-10 status-comment" ng-show="history.description.value !== ''">
                            <span class="italic">{{ history.description.value }}</span>
                        </div>
                        <div class="row">
                            <table class="table width-100 stripped condensed" ng-show="histDocs.length > 0">
                                <caption>Приложения</caption>
                                <tbody>
                                <tr ng-repeat="doc in histDocs = (app.currentRequestStatusDocs.items | byRequestId:app.currentRequest.id.value:history.id.value) track by $id(doc)">
                                    <td>
                                        <a href="{{ 'serverside/controllers/downloader.php?docType=rsd&rsdId=' + doc.id.value }}">{{ doc.title.value }}</a>&nbsp;
                                        <span class="secondary-text right">{{ doc.size.value | fileSize }}</span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="row status-info">
                            <span class="secondary-text" ng-show="history.statusId.value === 1">{{ "Заявку добавил " + users.users.find("id", history.userId.value).fio }}</span>
                            <span class="secondary-text" ng-show="history.statusId.value !== 1">{{ "Статус изменил " + users.users.find("id", history.userId.value).fio }}</span>
                        </div>
                        -->
                    </li>
                </ul>

            </div>
        </td>
    </tr>
</table>